var __spreadArray=this&&this.__spreadArray||function(e,t,o){if(o||2===arguments.length)for(var n,i=0,r=t.length;i<r;i++)!n&&i in t||((n=n||Array.prototype.slice.call(t,0,i))[i]=t[i]);return e.concat(n||Array.prototype.slice.call(t))},__extends=this&&this.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}))(e,t)};return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}}();function isEmailValid(e){return e.includes("@")}function isUrlValid(e){return e.includes("http")}var imgZoom=function(){function e(){var e=this;this.selector='[data-action="imageZoomIn"]',this.selectorAttr="href",this.currentIndex=0,this.images=[],this.getZoomImages(),window.addEventListener("resize",function(){document.querySelector(".overlay")&&e.loadImage(e.images[e.currentIndex])})}return e.prototype.getZoomImages=function(){var o=this,e=Array.from(document.querySelectorAll(this.selector));this.images=__spreadArray([],e,!0).map(function(e){return e.getAttribute(o.selectorAttr)}).filter(function(e){return null!==e}),e.forEach(function(t){t.addEventListener("click",function(e){e.preventDefault();e=t.getAttribute(o.selectorAttr);o.showOverlay(e)})})},e.prototype.renderNav=function(){var e="".concat(this.currentIndex+1,"/").concat(this.images.length),t=document.querySelector(".image--nav");t&&(t.innerHTML=e)},e.prototype.prevImage=function(){0!==this.currentIndex&&(this.currentIndex=this.currentIndex-1,this.loadImage(this.images[this.currentIndex]),this.renderNav())},e.prototype.nextImage=function(){this.currentIndex!==this.images.length-1&&(this.currentIndex=this.currentIndex+1,this.loadImage(this.images[this.currentIndex]),this.renderNav())},e.prototype.showOverlay=function(e){var t=this,o=this.images.indexOf(e),o=(this.currentIndex=o,1<this.images.length?'<div class="image--nav">'.concat(o+1,"/").concat(this.images.length,'</div><button title="Prev" type="button" class="mfp-arrow mfp-arrow-left mfp-prevent-close"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" aria-hidden="true">\n            <path d="M14.4998 7.80903C14.4742 7.74825 14.4372 7.69292 14.3908 7.64603L8.68084 1.93803C8.58696 1.84427 8.45967 1.79165 8.32699 1.79175C8.19431 1.79184 8.0671 1.84464 7.97334 1.93853C7.87959 2.03241 7.82697 2.1597 7.82707 2.29238C7.82716 2.42506 7.87996 2.55227 7.97384 2.64603L12.8278 7.50003H1.96484C1.83224 7.50003 1.70506 7.5527 1.61129 7.64647C1.51752 7.74024 1.46484 7.86742 1.46484 8.00003C1.46484 8.13263 1.51752 8.25981 1.61129 8.35358C1.70506 8.44735 1.83224 8.50003 1.96484 8.50003H12.8278L7.97384 13.354C7.87996 13.4478 7.82716 13.575 7.82707 13.7077C7.82697 13.8404 7.87959 13.9676 7.97334 14.0615C8.0671 14.1554 8.19431 14.2082 8.32699 14.2083C8.45967 14.2084 8.58696 14.1558 8.68084 14.062L14.3878 8.35403C14.4342 8.30713 14.4712 8.2518 14.4968 8.19103C14.5478 8.069 14.5489 7.93184 14.4998 7.80903Z"></path>\n        </svg></button><button title="Next (Right arrow key)" type="button" class="mfp-arrow mfp-arrow-right mfp-prevent-close"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" aria-hidden="true">\n            <path d="M14.4998 7.80903C14.4742 7.74825 14.4372 7.69292 14.3908 7.64603L8.68084 1.93803C8.58696 1.84427 8.45967 1.79165 8.32699 1.79175C8.19431 1.79184 8.0671 1.84464 7.97334 1.93853C7.87959 2.03241 7.82697 2.1597 7.82707 2.29238C7.82716 2.42506 7.87996 2.55227 7.97384 2.64603L12.8278 7.50003H1.96484C1.83224 7.50003 1.70506 7.5527 1.61129 7.64647C1.51752 7.74024 1.46484 7.86742 1.46484 8.00003C1.46484 8.13263 1.51752 8.25981 1.61129 8.35358C1.70506 8.44735 1.83224 8.50003 1.96484 8.50003H12.8278L7.97384 13.354C7.87996 13.4478 7.82716 13.575 7.82707 13.7077C7.82697 13.8404 7.87959 13.9676 7.97334 14.0615C8.0671 14.1554 8.19431 14.2082 8.32699 14.2083C8.45967 14.2084 8.58696 14.1558 8.68084 14.062L14.3878 8.35403C14.4342 8.30713 14.4712 8.2518 14.4968 8.19103C14.5478 8.069 14.5489 7.93184 14.4998 7.80903Z"></path>\n        </svg></button>'):""),o='<div class="overlay"><button class="zoomImgClose"><svg width="25" height="25" viewBox="0 0 25 25" xmlns="http://www.w3.org/2000/svg" class="q"><path d="M18.13 6.11l-5.61 5.61-5.6-5.61-.81.8 5.61 5.61-5.61 5.61.8.8 5.61-5.6 5.61 5.6.8-.8-5.6-5.6 5.6-5.62"/></svg></button><div class="overlay-img-wrap"><img class="overlay-image"><div class="lds-ripple"></div></div>'.concat(o,"</div>"),n=document.querySelector("body");n&&(n.insertAdjacentHTML("beforeend",o),n.classList.add("u-overflowYHidden")),this.loadImage(e),null!=(o=document.querySelector(".zoomImgClose"))&&o.addEventListener("click",function(){t.overlayRemove()}),null!=(n=document.querySelector(".mfp-arrow-right"))&&n.addEventListener("click",function(){t.nextImage()}),null!=(e=document.querySelector(".mfp-arrow-left"))&&e.addEventListener("click",function(){t.prevImage()})},e.prototype.loadImage=function(i){var r=new Image,a=document.querySelector(".lds-ripple"),c=(a&&(a.style.display="inline-block"),document.querySelector(".overlay-image")),s=document.querySelector(".image--nav");null!=s&&s.classList.add("u-hide"),c.style.display="none",r.onload=function(){var e=r.width,t=r.height,o=window.innerHeight-140,n=window.innerWidth-80;n<e?(t*=n/e,e=n,o<t&&(e*=o/t,t=o)):o<t&&(e*=o/t,t=o,n<e)&&(t*=n/e,e=n),c.setAttribute("src",i),c.style.width=e+"px",c.style.height=t+"px",c.style.display="block",null!=s&&s.classList.remove("u-hide"),null!=(o=document.querySelector(".overlay-img-wrap"))&&o.classList.add("is-finieshed"),a.style.display="none"},r.src=i},e.prototype.overlayRemove=function(){var e=document.querySelector(".overlay"),e=(e&&this._remove(e),document.querySelector("body"));e&&e.classList.remove("u-overflowYHidden")},e.prototype._remove=function(e){var t=e.parentNode;t&&t.removeChild(e)},e}(),farallonBase=(new imgZoom,function(){function e(){this.is_single=!1,this.post_id=0,this.is_archive=!1,this.darkmode=!1,this.is_single=obvInit.is_single,this.post_id=obvInit.post_id,this.is_archive=obvInit.is_archive,this.darkmode=obvInit.darkmode,this.VERSION=obvInit.version}return e.prototype.getCookie=function(e){if(0<document.cookie.length){var t=document.cookie.indexOf(e+"=");if(-1!=t)return t=t+e.length+1,-1==(e=document.cookie.indexOf(";",t))&&(e=document.cookie.length),document.cookie.substring(t,e)}return""},e.prototype.setCookie=function(e,t,o){var n=new Date,o=(n.setTime(n.getTime()+24*o*60*60*1e3),"expires="+n.toUTCString());document.cookie=e+"="+t+";"+o+";path=/"},e.prototype.showNotice=function(e,t){void 0===t&&(t="success");t='<div class="notice--wrapper">'.concat(e,"</div>");document.querySelector("body").insertAdjacentHTML("beforeend",t),document.querySelector(".notice--wrapper").classList.add("is-active"),setTimeout(function(){document.querySelector(".notice--wrapper").remove()},3e3)},e}()),farallonAction=function(o){function e(){var e=o.call(this)||this,t=(e.selctor=".like-btn",e.is_single=!1,e.post_id=0,e.is_archive=!1,e.is_single=obvInit.is_single,e.post_id=obvInit.post_id,e.is_archive=obvInit.is_archive,e.like_btn=document.querySelector(e.selctor),e.like_btn&&(e.like_btn.addEventListener("click",function(){e.handleLike()}),e.getCookie("like_"+e.post_id))&&e.like_btn.classList.add("is-active"),localStorage.getItem("theme")?localStorage.getItem("theme"):"auto"),t='<div class="fixed--theme">\n        <span class="'.concat("dark"==t?"is-active":"",'" data-action-value="dark">\n            <svg fill="none" height="24" shape-rendering="geometricPrecision" stroke="currentColor" stroke-linecap="round"\n                stroke-linejoin="round" stroke-width="1.5" viewBox="0 0 24 24" width="24"\n                style="color: currentcolor; width: 16px; height: 16px;">\n                <path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"></path>\n            </svg>\n        </span>\n        <span class="').concat("light"==t?"is-active":"",'" data-action-value="light">\n            <svg fill="none" height="24" shape-rendering="geometricPrecision" stroke="currentColor" stroke-linecap="round"\n                stroke-linejoin="round" stroke-width="1.5" viewBox="0 0 24 24" width="24"\n                style="color: currentcolor; width: 16px; height: 16px;">\n                <circle cx="12" cy="12" r="5"></circle>\n                <path d="M12 1v2"></path>\n                <path d="M12 21v2"></path>\n                <path d="M4.22 4.22l1.42 1.42"></path>\n                <path d="M18.36 18.36l1.42 1.42"></path>\n                <path d="M1 12h2"></path>\n                <path d="M21 12h2"></path>\n                <path d="M4.22 19.78l1.42-1.42"></path>\n                <path d="M18.36 5.64l1.42-1.42"></path>\n            </svg>\n        </span>\n        <span class="').concat("auto"==t?"is-active":"",'"  data-action-value="auto">\n            <svg fill="none" height="24" shape-rendering="geometricPrecision" stroke="currentColor" stroke-linecap="round"\n                stroke-linejoin="round" stroke-width="1.5" viewBox="0 0 24 24" width="24"\n                style="color: currentcolor; width: 16px; height: 16px;">\n                <rect x="2" y="3" width="20" height="14" rx="2" ry="2"></rect>\n                <path d="M8 21h8"></path>\n                <path d="M12 17v4"></path>\n            </svg>\n        </span>\n    </div>'),t=(e.darkmode&&document.querySelector("body").insertAdjacentHTML("beforeend",t),document.querySelectorAll(".fixed--theme span").forEach(function(e){e.addEventListener("click",function(){e.classList.contains("is-active")||(document.querySelectorAll(".fixed--theme span").forEach(function(e){e.classList.remove("is-active")}),"dark"==e.dataset.actionValue?(localStorage.setItem("theme","dark"),document.querySelector("body").classList.remove("auto"),document.querySelector("body").classList.add("dark"),e.classList.add("is-active")):"light"==e.dataset.actionValue?(localStorage.setItem("theme","light"),document.querySelector("body").classList.remove("auto"),document.querySelector("body").classList.remove("dark"),e.classList.add("is-active")):"auto"==e.dataset.actionValue&&(localStorage.setItem("theme","auto"),document.querySelector("body").classList.remove("dark"),document.querySelector("body").classList.add("auto"),e.classList.add("is-active")))})}),document.querySelector(".post--share")&&document.querySelector(".post--share").addEventListener("click",function(){navigator.clipboard.writeText(document.location.href).then(function(){e.showNotice("复制成功")})}),document.querySelector('[data-action="show-search"]').addEventListener("click",function(){document.querySelector(".site--header__center .inner").classList.toggle("search--active")}),e.is_single&&e.trackPostView(),e.is_archive&&e.trackArchiveView(),console.log("theme version: ".concat(e.VERSION," init success!")),'<div class="site--footer__info">\n        Theme <a href="https://fatesinger.com/101971" target="_blank">farallon</a> by bigfa / version '.concat(e.VERSION,"\n    </div>"));return document.querySelector(".site--footer__content").insertAdjacentHTML("afterend",t),document.querySelector(".icon--copryrights").addEventListener("click",function(){document.querySelector(".site--footer__info").classList.toggle("active")}),e}return __extends(e,o),e.prototype.trackPostView=function(){var e=obvInit.post_id,e=obvInit.restfulBase+"farallon/v1/view?id="+e;fetch(e,{headers:{"X-WP-Nonce":obvInit.nonce,"Content-Type":"application/json"}}).then(function(e){return e.json()}).then(function(e){console.log(e)})},e.prototype.trackArchiveView=function(){var e;document.querySelector(".archive-header")&&(e=obvInit.archive_id,fetch("".concat(obvInit.restfulBase,"farallon/v1/archive/").concat(e),{method:"POST",headers:{"X-WP-Nonce":obvInit.nonce,"Content-Type":"application/json"}}).then(function(e){return e.json()}).then(function(e){}))},e.prototype.handleLike=function(){var t=this;if(this.getCookie("like_"+this.post_id))return this.showNotice("You have already liked this post");var e=obvInit.restfulBase+"farallon/v1/like";fetch(e,{method:"POST",body:JSON.stringify({id:this.post_id}),headers:{"X-WP-Nonce":obvInit.nonce,"Content-Type":"application/json"}}).then(function(e){return e.json()}).then(function(e){t.showNotice("Thanks for your like"),t.setCookie("like_"+t.post_id,"1",1)}),this.like_btn.classList.add("is-active")},e.prototype.refresh=function(){},e}(farallonBase),farallonComment=(new farallonAction,function(t){function e(){var e=t.call(this)||this;return e.loading=!1,e.init(),e}return __extends(e,t),e.prototype.init=function(){var e,a=this;document.querySelector(".comment-form")&&null!=(e=document.querySelector(".comment-form"))&&e.addEventListener("submit",function(e){var o;e.preventDefault(),a.loading||(e=document.querySelector(".comment-form"),e=new FormData(e),o={},e.forEach(function(e,t){return o[t]=e}),a.loading=!0,fetch(obvInit.restfulBase+"farallon/v1/comment",{method:"POST",body:JSON.stringify(o),headers:{"X-WP-Nonce":obvInit.nonce,"Content-Type":"application/json"}}).then(function(e){return e.json()}).then(function(e){if(a.loading=!1,200!=e.code)return a.showNotice(e.message,"error");var t=document.getElementById("cancel-comment-reply-link"),o=document.getElementById("respond"),n=document.getElementById("wp-temp-form-div"),e=e.data,i='<li class="comment" id="comment-'.concat(e.comment_ID,'">\n                        <div class="comment-body comment-body__fresh">\n                            <footer class="comment-meta">\n                                <div class="comment--avatar">\n                                    <img alt="" src="').concat(e.author_avatar_urls,'" class="avatar" height="42" width="42" />\n                                </div>\n                                <div class="comment--meta">\n                                    <div class="comment--author">').concat(e.comment_author,'<span class="dot"></span>\n                                    <time>刚刚</time>\n                                    </div>\n                                </div>\n                            </footer>\n                            <div class="comment-content">\n                                ').concat(e.comment_content,"\n                            </div>\n                        </div>\n                    </li>"),r=null==(r=document.querySelector("#comment_parent"))?void 0:r.value,o=(t.style.display="none",t.onclick=null,document.getElementById("comment_parent").value="0",n&&o&&(n.parentNode.insertBefore(o,n),n.parentNode.removeChild(n)),document.querySelector(".comment-body__fresh")&&null!=(t=document.querySelector(".comment-body__fresh"))&&t.classList.remove("comment-body__fresh"),document.getElementById("comment").value="","0"!=r?(null!=(o=document.querySelector("#comment-"+r))&&o.insertAdjacentHTML("beforeend",'<ol class="children">'+i+"</ol>"),console.log(r)):(document.querySelector(".no--comment")&&null!=(n=document.querySelector(".no--comment"))&&n.remove(),null!=(t=document.querySelector(".commentlist"))&&t.insertAdjacentHTML("beforeend",i)),document.querySelector("#comment-".concat(e.comment_ID)));o&&o.scrollIntoView({behavior:"smooth"}),a.showNotice("评论成功")}))})},e}(farallonBase)),farallonDate=(new farallonComment,function(){function e(e){var t=this;this.timeFormat={second:"second ago",seconds:"seconds ago",minute:"minute ago",minutes:"minutes ago",hour:"hour ago",hours:"hours ago",day:"day ago",days:"days ago",week:"week ago",weeks:"weeks ago",month:"month ago",months:"months ago",year:"year ago",years:"years ago"},this.doms=[],this.selector=e.selector,e.timeFormat&&(this.timeFormat=e.timeFormat),this.init(),setTimeout(function(){t.refresh()},5e3)}return e.prototype.init=function(){var t=this;this.doms=Array.from(document.querySelectorAll(this.selector)),this.doms.forEach(function(e){e.innerText=t.humanize_time_ago(e.attributes.datetime.value)})},e.prototype.humanize_time_ago=function(e){var e=new Date(e),t=Date.now()/1e3-Number(e.getTime()/1e3);return t<3600?"".concat(Math.ceil(t/60)," ").concat(1==Math.ceil(t/60)?this.timeFormat.second:this.timeFormat.seconds):t<86400?"".concat(Math.ceil(t/3600)," ").concat(1==Math.ceil(t/3660)?this.timeFormat.hour:this.timeFormat.hours):t<2592e3?"".concat(Math.ceil(t/86400)," ").concat(1==Math.ceil(t/86400)?this.timeFormat.day:this.timeFormat.days):t<31104e3?"".concat(Math.ceil(t/2592e3)," ").concat(1==Math.ceil(t/2592e3)?this.timeFormat.month:this.timeFormat.months):e.getFullYear()+"-"+(e.getMonth()+1)+"-"+e.getDate()},e.prototype.refresh=function(){var t=this;this.doms.forEach(function(e){e.innerText=t.humanize_time_ago(e.attributes.datetime.value)})},e}()),farallonPost=(new farallonDate({selector:".humane--time",timeFormat:obvInit.timeFormat}),function(t){function e(){var e=t.call(this)||this;return e.loading=!1,e.page=1,e.init(),e}return __extends(e,t),e.prototype.init=function(){var e,t=this;document.querySelector(".loadmore")&&(this.button=document.querySelector(".loadmore"),null!=(e=document.querySelector(".loadmore")))&&e.addEventListener("click",function(e){e.preventDefault(),t.loading||(t.loading=!0,t.page++,t.fetchPosts())})},e.prototype.randerPosts=function(e){var t,e=e.map(function(e){var t=obvInit.hide_home_cover||!e.has_image?"":'<a href="'.concat(e.permalink,'" aria-label="').concat(e.post_title,'" class="cover--link">\n                <img src="').concat(e.thumbnail,'" class="cover" alt="').concat(e.post_title,'">\n                        </a>');return'<article class="post--item" itemtype="http://schema.org/Article" itemscope="itemscope">\n            <div class="content">\n                <h2 class="post--title" itemprop="headline">\n                    <a href="'.concat(e.permalink,'" aria-label="').concat(e.post_title,'">\n                        ').concat(e.post_title,'</a>\n                </h2>\n                <div class="description" itemprop="about">').concat(e.excerpt,'</div>\n                <div class="meta">\n                    <svg class="icon" viewBox="0 0 1024 1024" width="16" height="16">\n                        <path d="M512 97.52381c228.912762 0 414.47619 185.563429 414.47619 414.47619s-185.563429 414.47619-414.47619 414.47619S97.52381 740.912762 97.52381 512 283.087238 97.52381 512 97.52381z m0 73.142857C323.486476 170.666667 170.666667 323.486476 170.666667 512s152.81981 341.333333 341.333333 341.333333 341.333333-152.81981 341.333333-341.333333S700.513524 170.666667 512 170.666667z m36.571429 89.697523v229.86362h160.865523v73.142857H512a36.571429 36.571429 0 0 1-36.571429-36.571429V260.388571h73.142858z"></path>\n                    </svg>\n                    <time itemprop="datePublished" datetime="" class="humane--time">').concat(e.date,"</time>\n                                                    </div>\n            </div>").concat(t,"\n            </article>")}).join("");null!=(t=document.querySelector(".posts--list"))&&(t.innerHTML+=e)},e.prototype.fetchPosts=function(){var o=this;this.button.innerHTML="加载中...",fetch(obvInit.restfulBase+"farallon/v1/posts?page="+this.page,{method:"get",headers:{"X-WP-Nonce":obvInit.nonce,"Content-Type":"application/json"}}).then(function(e){return e.json()}).then(function(e){var t;if(o.loading=!1,200!=e.code)return o.showNotice(e.message,"error");0==e.data.length?(null!=(t=document.querySelector(".loadmore"))&&t.remove(),o.showNotice("没有更多文章了","error")):(o.randerPosts(e.data),o.showNotice("加载成功","error")),o.button.innerHTML="加载更多"})},e}(farallonBase)),farallonScroll=(new farallonPost,function(){function e(){var e;this.is_single=!1,this.is_single=obvInit.is_single,this.init(),document.querySelector(".backToTop")&&(e=document.querySelector(".backToTop"),window.addEventListener("scroll",function(){200<(window.scrollY||window.pageYOffset)?e.classList.add("is-active"):e.classList.remove("is-active")}),e.addEventListener("click",function(){window.scrollTo({top:0,behavior:"smooth"})}))}return e.prototype.init=function(){this.scroll()},e.prototype.scroll=function(){var t=this,e=document.querySelector(".post-navigation"),o=e?e.offsetTop:0,n=window.innerHeight;window.addEventListener("scroll",function(){var e;10<window.scrollY?null!=(e=document.querySelector(".site--header"))&&e.classList.add("is-active"):null!=(e=document.querySelector(".site--header"))&&e.classList.remove("is-active"),t.is_single&&(window.scrollY>o-n?null!=(e=document.querySelector(".post-navigation"))&&e.classList.add("is-active"):null!=(e=document.querySelector(".post-navigation"))&&e.classList.remove("is-active"))})},e}());new farallonScroll;